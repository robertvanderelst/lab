/* PROFORMA 2.0 by Robert van der Elst, Â© 2014-2015. Github: http://www.github.com/robertvanderelst/proforma */
!function(){"use strict";var e,s,t,a,n,l,i,p,c,r,o,f,h,d=navigator.userAgent.match(/Mobi/i);$.proforma={options:{checkboxClass:"checkbox",checkedClass:"checked",desktopClass:"is-desktop",fileClass:"file",fileButtonClass:"file-button",fileButtonText:"Choose File",fileValueClass:"file-value",fileValueDefaultText:"No file selected",optGroupClass:"optgroup",pluginClass:"proforma",prefix:"pf-",radioClass:"radio",selectedClass:"selected",selectClass:"select",selectValueClass:"select-value",visibleClass:"visible"},elements:[]},$.fn.proforma=function(u){function C(e){return t=e.attr("type"),void 0===t&&("SELECT"===e[0].tagName&&(t="select"),"TEXTAREA"===e[0].tagName&&(t="textarea")),t}function x(e,s){e.on("mouseover",function(){s.addClass("hover")}).on("mouseout",function(){s.removeClass("hover")})}function v(e,s){e.on("focus",function(){s.addClass("focus")}).on("blur",function(){s.removeClass("focus")}),e.focus()}function g(e,s){s=s.substring(s.lastIndexOf("\\")+1,s.length),s=s.substring(s.lastIndexOf("/")+1,s.length),e.parent().find("."+u.prefix+u.fileValueClass).text(s)}function m(e){e.parent().offset().top+e.parent().height()+e.next().height()>=$(document).height()&&e.next().addClass("reverse"),e.next().addClass(u.prefix+u.visibleClass)}function k(e){e.next().removeClass("reverse"),e.next().removeClass(u.prefix+u.visibleClass)}function b(e,s){e.find("option").each(function(){$(this).attr("selected",!1)}),e.find("option").eq(s).attr("selected",!0)}function q(e,s){if(!e.parents("span").hasClass(u.pluginClass))switch(s){case"checkbox":case"radio":a=u.pluginClass+" "+u.prefix+u[s+"Class"],e.prop("checked")&&(a=a+" "+u.checkedClass),e.wrap('<span class="'+a+'"></span>'),x(e,e.parent()),v(e,e.parent()),e.on("click",function(e){e.stopPropagation(),"radio"===s&&$("input[name='"+$(this).prop("name")+"']").each(function(){$(this).parent().removeClass(u.checkedClass)}),$(this).prop("checked")?$(this).parent().addClass(u.checkedClass):$(this).parent().removeClass(u.checkedClass)});break;case"file":a=u.pluginClass+" "+u.prefix+u[s+"Class"],e.wrap('<span class="'+a+'"></span>'),e.before('<span class="'+u.prefix+u.fileValueClass+'">'+u.fileValueDefaultText+"</span><span class="+u.prefix+u.fileButtonClass+">"+u.fileButtonText+"</span>"),x(e,e.parent()),v(e,e.parent()),e.on("click",function(s){s.stopPropagation(),l=$(this).val(),l.length>0?g(e,l):$(this).on("change",function(){g($(this),$(this).val())})});break;case"select":e.children().length>0&&!e.attr("multiple")&&(i=e.find("option").eq(e.prop("selectedIndex")).text(),a=u.pluginClass+" "+u.prefix+u[s+"Class"],e.wrap('<span class="'+a+'" />'),e.parent().prepend('<span class="'+u.prefix+u.selectValueClass+'">'+i+"</span>"),d?e.on("change",function(){$("."+u.prefix+u.selectValueClass+" span").text(e.find("option").eq(e.prop("selectedIndex")).text())}):(p=0,e.addClass(u.prefix+u.desktopClass),n=$('<ul class="options-list" />'),e.children().each(function(){c="","OPTGROUP"===$(this)[0].tagName?(n.append('<li class="'+u.prefix+u.optGroupClass+'"><span>'+$(this).attr("label")+"</span><ul></ul></li>"),$(this).children("option").each(function(){c="",$(this).attr("selected")&&(i=$(this).text(),c=' class="'+u.prefix+u.selectedClass+'"'),n.find("li:last-child ul").append("<li"+c+'><a href="#" data-option="'+p+'">'+$(this).text()+"</a></li>"),p+=1})):($(this).attr("selected")&&(i=$(this).text(),c=' class="'+u.prefix+u.selectedClass+'"'),n.append("<li"+c+'><a href="#" data-option="'+p+'">'+$(this).text()+"</a></li>"),p+=1)}),e.after(n),x(e.parent(),e.parent()),v(e,e.parent()),e.parent().on("click",function(s){s.stopPropagation(),m(e)}),f=e.next().find("a"),e.next().find("a").on("click",function(s){s.preventDefault(),s.stopPropagation(),r=$(this).attr("data-option"),$(this).parents("."+u.prefix+u.selectClass).find("> span").text($(this).text()),b(e,r),f.each(function(){$(this).parent().removeClass(u.prefix+u.selectedClass)}),$(this).parent().addClass(u.prefix+u.selectedClass),k(e)}),e.parent().on("keydown",function(e){(13===e.which||32===e.which)&&e.preventDefault()})))}}return u=$.extend($.proforma.options,u),$("html").on("click",function(){$("."+u.prefix+u.selectClass+" ul").removeClass(u.prefix+u.visibleClass)}),$("html").on("keydown",function(e){switch(s=$(document.activeElement),"SELECT"===s[0].tagName&&(o=s.next(),f=o.find("a")),e.which){case 38:case 40:e.preventDefault()}}).on("keyup",function(e){switch(s=$(document.activeElement),"SELECT"===s[0].tagName&&(o=s.next(),f=o.find("a")),e.which){case 13:case 32:o.length>0&&!o.hasClass(u.prefix+u.visibleClass)?(m(s),f.eq(s.prop("selectedIndex")).focus()):o.length>0&&o.hasClass(u.prefix+u.visibleClass)&&(f.each(function(e){$(this).parent().hasClass(u.prefix+u.selectedClass)&&(r=e)}),o.parent().find("span").text(f.eq(r).text()),b(o.prev(),r),k(o.prev()),v(o.prev(),o.parent()));break;case 27:o.length>0&&o.hasClass(u.prefix+u.visibleClass)&&(k(o.prev()),o.prev().focus(),o.parent().addClass("focus"));break;case 38:o.length>0&&(h=0,$(f).each(function(e){$(this).parent().hasClass(u.prefix+u.selectedClass)&&(h=e)}),h-1>=0&&($(f).eq(h).parent().removeClass(u.prefix+u.selectedClass),$(f).eq(h-1).parent().addClass(u.prefix+u.selectedClass),$(f).eq(h-1).focus()),f.each(function(e){$(this).parent().hasClass(u.prefix+u.selectedClass)&&(r=e)}),o.parent().find("span").text(f.eq(r).text()),b(o.prev(),r));break;case 40:o.length>0&&(h=0,$(f).each(function(e){$(this).parent().hasClass(u.prefix+u.selectedClass)&&(h=e)}),h+1<=f.length&&($(f).eq(h).parent().removeClass(u.prefix+u.selectedClass),$(f).eq(h+1).parent().addClass(u.prefix+u.selectedClass),$(f).eq(h+1).focus()),f.each(function(e){$(this).parent().hasClass(u.prefix+u.selectedClass)&&(r=e)}),o.parent().find("span").text(f.eq(r).text()),b(o.prev(),r));break;case 9:o.length>0&&o.hasClass(u.prefix+u.visibleClass)&&(k(o.prev()),v(o.prev(),o.parent()));break;default:return}}),this.each(function(){e=$(this),t=C(e),q(e,t)})}}($,document,navigator);